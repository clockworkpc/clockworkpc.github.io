<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mass Assignment | CPC Blog</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Mass Assignment" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Security Flaw of Mass Assignment" />
<meta property="og:description" content="Security Flaw of Mass Assignment" />
<link rel="canonical" href="http://localhost:4000/2020/03/31/mass_assignment.html" />
<meta property="og:url" content="http://localhost:4000/2020/03/31/mass_assignment.html" />
<meta property="og:site_name" content="CPC Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-31T10:28:19-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Mass Assignment" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-03-31T10:28:19-04:00","datePublished":"2020-03-31T10:28:19-04:00","description":"Security Flaw of Mass Assignment","headline":"Mass Assignment","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/03/31/mass_assignment.html"},"url":"http://localhost:4000/2020/03/31/mass_assignment.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="CPC Blog" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">CPC Blog<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-cyan-hover" href="https://twitter.com/alexandergarber"><i class="fab fa-twitter-square"></i></a>
        
        
        
        <a class="color-red-hover" href="http://clockworkpc.com.au"><i class="fab fa-itch-io"></i></a>
        
        
        
        <a class="color-purple-hover" href="https://github.com/clockworkpc"><i class="fab fa-github-square"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">

<div class="description">A blog about software by Alexander JK Garber.</div>

</div>


<div class="post">
  <h1 class="post-title">Mass Assignment</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="rails">rails</a>
      
      <a class="tag" href="security">security</a>
      
      <a class="tag" href="crud">crud</a>
      
  </div>
  
  <div class="post-date">
    Published on 31 Mar 2020
    
  </div>
  
  <h2 id="security-flaw-of-mass-assignment">Security Flaw of Mass Assignment</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Valid</span>
<span class="vi">@user</span><span class="p">.</span><span class="nf">update_attributes</span><span class="p">({</span><span class="ss">username: </span><span class="s1">'kskoglund'</span><span class="p">})</span>

<span class="c1"># Hacked</span>
<span class="vi">@user</span><span class="p">.</span><span class="nf">update_attributes</span><span class="p">({</span><span class="ss">username: </span><span class="s1">'733thax0r'</span><span class="p">,</span> <span class="ss">password: </span><span class="s1">'nososecretanymore'</span><span class="p">,</span> <span class="ss">admin: </span><span class="kp">true</span><span class="p">})</span>
</code></pre></div></div>

<h2 id="failing-code-activemodelforbiddenattributeserror">Failing Code (ActiveModel::ForbiddenAttributesError)</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create</span>
    <span class="c1"># Instantiate a new object using form parameters.</span>
    <span class="vi">@subject</span> <span class="o">=</span> <span class="no">Subject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:subject</span><span class="p">])</span>
    <span class="n">params</span><span class="p">.</span><span class="nf">permit</span>

    <span class="c1"># Save the object.</span>
    <span class="k">if</span> <span class="vi">@subject</span><span class="p">.</span><span class="nf">save</span>
    <span class="c1"># If save succeeds, redirect to index action.</span>
    <span class="n">redirect_to</span><span class="p">(</span><span class="n">subjects_path</span><span class="p">)</span>
    <span class="k">else</span>
    <span class="c1"># If save fails, redisplay the form.</span>
    <span class="n">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="strong-parameters-ie-whitelisting">Strong Parameters, i.e. Whitelisting</h2>

<h3 id="permit"><a href="https://devdocs.io/rails~6.0/actioncontroller/parameters#method-i-permit">#permit</a>:</h3>

<blockquote>
  <p>Returns a new ActionController::Parameters instance that includes only the given filters and sets the permitted attribute for the object to true. This is useful for limiting which attributes should be allowed for mass updating.</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">params</span> <span class="o">=</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">user: </span><span class="p">{</span> <span class="ss">name: </span><span class="s2">"Francesco"</span><span class="p">,</span> <span class="ss">age: </span><span class="mi">22</span><span class="p">,</span> <span class="ss">role: </span><span class="s2">"admin"</span> <span class="p">})</span>
<span class="n">permitted</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">)</span>
<span class="n">permitted</span><span class="p">.</span><span class="nf">permitted?</span>      <span class="c1"># =&gt; true</span>
<span class="n">permitted</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="c1"># =&gt; true</span>
<span class="n">permitted</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="ss">:age</span><span class="p">)</span>  <span class="c1"># =&gt; true</span>
<span class="n">permitted</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="ss">:role</span><span class="p">)</span> <span class="c1"># =&gt; false</span>
</code></pre></div></div>

<h3 id="require"><a href="https://devdocs.io/rails~6.0/actioncontroller/parameters#method-i-require">#require</a></h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ActionController</span><span class="o">::</span><span class="no">Parameters</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">person: </span><span class="p">{</span> <span class="ss">name: </span><span class="s2">"Francesco"</span> <span class="p">}).</span><span class="nf">require</span><span class="p">(</span><span class="ss">:person</span><span class="p">)</span>
<span class="c1"># =&gt; &lt;ActionController::Parameters {"name"=&gt;"Francesco"} permitted: false&gt;</span>
</code></pre></div></div>

<h3 id="example">Example</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">name: </span><span class="s1">'John Smith'</span><span class="p">,</span> <span class="ss">email: </span><span class="s1">'john.smith@me.com'</span><span class="p">,</span> <span class="ss">admin: </span><span class="kp">false</span> <span class="p">}</span>

<span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">])</span>
<span class="n">permitted</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">].</span><span class="nf">require</span><span class="p">(</span><span class="ss">:email</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="passing-code">Passing Code</h2>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SubjectsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

    <span class="k">def</span> <span class="nf">create</span>
        <span class="vi">@subject</span> <span class="o">=</span> <span class="no">Subject</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">subject_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="vi">@subject</span><span class="p">.</span><span class="nf">save</span>
            <span class="n">redirect_to</span><span class="p">(</span><span class="n">subjects_path</span><span class="p">)</span>
        <span class="k">else</span>
            <span class="n">render</span><span class="p">(</span><span class="s1">'new'</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">subject_params</span>
        <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:subject</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:position</span><span class="p">,</span> <span class="ss">:visible</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'http://localhost:4000/2020/03/31/mass_assignment.html';
     this.page.identifier = '/2020/03/31/mass_assignment';
     this.page.title = 'Mass Assignment';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//<your-discuss-shortname>.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2022/12/22/Javascript_Calculator.html">
            Javascript_calculator
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/05/04/Check_Method_Definition_in_Ruby.html">
            Check Method Definition in Ruby
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/04/19/open_multiple_tabs_in_vim_from_string_input.html">
            open multiple tabs in vim from string input
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
